# 一进二低吸战法量化交易策略

## 策略概述

本策略是一种基于技术指标和价格行为的A股量化交易策略，主要针对涨停后的低吸机会，通过MACD指标的变化来捕捉买入和卖出时机。策略名称"一进二低吸"代表在涨停后的回调中进行低吸，并在合适的时机分批次获利了结。

## 选股条件

策略首先通过以下条件筛选出潜在的交易标的：

1. **涨停筛选**：选择昨天涨停的股票，但排除一字板（开盘价等于收盘价或成交量严重缩量）的股票
2. **首次涨停**：要求是近3个交易日内的首次涨停
3. **价格创新高**：昨天收盘价是近30个交易日的最高价
4. **基本面限制**：
   - 仅选择主板股票
   - 排除停牌股票
   - 排除ST股（ST股的代码中包含"ST"或"*ST"）
   - 公司总市值上限为150亿元

## 买入条件

对于符合选股条件的股票，在满足以下条件时买入（每次触发买入金额为10000元，可配置）：

1. **MACDFS指标条件**：当MACDFS绿柱（即DIF-DEA为负值）连续两根上缩（即绿柱变短）时
2. **日内涨幅限制**：从开盘到当前时刻，分时最高价不能超过9%的涨幅（可配置）
3. **分时均价限制**：当前价格必须大于当时的累计分时均价（黄线）
4. **价格保护机制**：同一只股票，如果当天已经有成交，则根据条件1再次触发的买入价格不能低于当天该股票上一次买入价格
5. **仓位管理机制**：同一只股票，当日最多只能买入2次（可配置）

## 卖出条件

持仓股票的卖出分为两种情况：

1. **次日开盘卖出条件**：
   - 若次日开盘价低于昨日收盘价
   - 且第1分钟K线收阴（收盘价低于开盘价）
   - 则该股票清仓（卖出全部持仓）

2. **涨停开板卖出**
   - 若上一分钟为涨停，但当前已低于开盘价（即开板），则全仓卖出

3. **MACDFS指标卖出条件**：
   - 当MACDFS红柱（即DIF-DEA为正值）连续下缩2根时触发卖出
   - 一天内可能有多次触发
   - 第一次触发时卖出1/2仓位
   - 第二次触发时卖出剩余所有仓位
   - 若当前为涨停价，即使以上条件符合，也不会卖出



## 技术指标说明

### MACDFS指标（分时MACD）

本策略使用的是同花顺软件中的MACDFS（12,26,9）指标，这是一种专门用于分时图的MACD指标。

#### 计算公式

- **DIF** = EMA(NEW,12) - EMA(NEW,26)
- **DEA** = EMA(DIF,9)
- **MACDFS** = 2 * (DIF-DEA)

其中NEW表示当前分钟的收盘价（分时价格）。

#### MACDFS的特殊计算机制

**重要特性**：MACDFS与传统日线MACD的最大区别在于，它从当日开盘后的第一分钟就开始计算，而不需要等待足够的历史数据。

**开盘EMA初始化机制**：
1. **第一分钟计算**：开盘第一分钟时，EMA12和EMA26的初始值通常设为开盘价
2. **快速收敛**：由于分时数据密度高（1分钟一个数据点），EMA能够快速收敛到合理的数值范围
3. **实时响应**：这种机制使得MACDFS能够在开盘后立即提供有效的技术信号

#### 计算注意事项

1. **数据源要求**：需要使用1分钟级别的分时数据作为计算基础
2. **开盘处理**：开盘第一分钟的EMA值初始化为开盘价，后续按标准EMA公式递推计算
3. **连续性**：每个交易日的MACDFS计算相对独立，不依赖前一交易日的数值


### 绿柱上缩与红柱下缩判断

- **绿柱上缩**：当前MACDFS值为负，且比前一个MACDFS值大（即绝对值变小，绿柱变短）
- **红柱下缩**：当前MACDFS值为正，且比前一个MACDFS值小（即红柱变短）

### 分时均价（黄线）

分时均价是股票分时图中的重要参考线，通常以黄色线条显示，代表当日的平均成交价格。

#### 计算公式

**分时均价** = 当日累计成交金额 ÷ 当日累计成交股数


## 实现注意事项

1. 选股条件需要每日收盘后或开盘前（或程序运行时）计算并形成股池，为后续交易做准备。
2. MACDFS指标计算需要使用分钟级数据
3. 买入和卖出信号需要实时监控
4. 需要记录每只股票的买入次数和买入价格，以实现价格保护机制和分批卖出